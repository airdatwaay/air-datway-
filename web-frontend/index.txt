<!doctype html>
<html>
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Air Datway Logistics</title>
  <style>
    :root{--accent:#0b56a3;--muted:#666}
    body{font-family:system-ui,-apple-system,Segoe UI,Roboto,Arial;max-width:980px;margin:28px auto;padding:18px;color:#111}
    header{display:flex;align-items:center;justify-content:space-between}
    nav a{margin-left:12px;color:var(--accent);text-decoration:none;font-weight:600}
    nav a.active{color:#000}
    .hero{margin-top:18px;padding:18px;background:#f6f8fb;border-radius:10px}
    .card{background:#fff;padding:14px;border-radius:10px;box-shadow:0 2px 8px rgba(0,0,0,0.06);margin-top:14px}
    .row{display:flex;gap:12px;align-items:center}
    input,textarea,select{padding:10px;border-radius:8px;border:1px solid #d0d5db;font-size:15px;width:100%}
    button{background:var(--accent);color:white;padding:10px 14px;border-radius:8px;border:none;cursor:pointer}
    .muted{color:var(--muted);font-size:14px}
    .events{margin-top:12px}
    .event{padding:10px;border-left:4px solid #ddd;background:#fbfbfb;border-radius:6px;margin-bottom:8px}
    footer{margin-top:28px;color:var(--muted);font-size:14px;text-align:center}
    .cols{display:grid;grid-template-columns:1fr 1fr;gap:12px}
    @media (max-width:700px){ .row{flex-direction:column} .cols{grid-template-columns:1fr} nav a{display:inline-block;margin:8px 8px 0 0} }
    pre{background:#fafafa;padding:12px;border-radius:8px;border:1px solid #eee;white-space:pre-wrap;overflow:auto}
  </style>
</head>
<body>
  <header>
    <div>
      <strong style="font-size:20px">Air Datway Logistics</strong>
      <div class="muted" style="font-size:13px">Simple demo tracking & order creation</div>
    </div>
    <nav>
      <a href="#" data-view="home" class="navlink">Home</a>
      <a href="#" data-view="track" class="navlink">Track</a>
      <a href="#" data-view="create" class="navlink">Create Order</a>
      <a href="#" data-view="about" class="navlink">About</a>
      <a href="#" data-view="contact" class="navlink">Contact</a>
    </nav>
  </header>

  <main id="app">
    <!-- home -->
    <section id="home" class="view">
      <div class="hero">
        <h2>Welcome to Air Datway</h2>
        <p class="muted">Fast demo: create an order and check its tracking status. This site is connected to a demo backend on Render.</p>
        <div class="cols">
          <div class="card">
            <h3 class="muted">Quick test</h3>
            <p>Click <strong>Create Order</strong> to add a demo shipment (it returns a tracking number you can immediately use in Track).</p>
          </div>
          <div class="card">
            <h3 class="muted">Backend status</h3>
            <p id="backend-status">Checking...</p>
          </div>
        </div>
      </div>
    </section>

    <!-- track -->
    <section id="track" class="view" style="display:none">
      <div class="card">
        <h3>Track your shipment</h3>
        <div class="row" style="margin-top:10px">
          <input id="trackInput" placeholder="Enter tracking number (e.g. ADL-...)" />
          <button id="trackBtn">Track</button>
        </div>
        <div id="trackResult" style="margin-top:14px"></div>
      </div>
    </section>

    <!-- create order -->
    <section id="create" class="view" style="display:none">
      <div class="card">
        <h3>Create a demo order</h3>
        <div style="margin-top:10px" class="cols">
          <div>
            <label class="muted">From (city)</label>
            <input id="fromCity" placeholder="e.g. Lagos" value="Lagos" />
          </div>
          <div>
            <label class="muted">To (city)</label>
            <input id="toCity" placeholder="e.g. Abuja" value="Abuja" />
          </div>
        </div>

        <div style="margin-top:12px" class="row">
          <input id="weight" placeholder="Weight (kg)" value="2" />
          <input id="price" placeholder="Price (Naira)" value="2000" />
        </div>

        <div style="margin-top:12px">
          <input id="customerName" placeholder="Customer name" value="Test User" />
        </div>

        <div style="margin-top:12px" class="row">
          <button id="createBtn">Create Order</button>
          <div id="createMsg" class="muted"></div>
        </div>

        <div id="createResult" style="margin-top:14px"></div>
      </div>
    </section>

    <!-- about -->
    <section id="about" class="view" style="display:none">
      <div class="card">
        <h3>About Air Datway</h3>
        <p class="muted">This is a demo site for Air Datway Logistics — a starter tracking & order system. Use Create Order to generate a test tracking number and Track to follow it.</p>
      </div>
    </section>

    <!-- contact -->
    <section id="contact" class="view" style="display:none">
      <div class="card">
        <h3>Contact</h3>
        <p class="muted">For demo help, reply here in chat. For production, we can configure email, phone, SMS, and an admin panel.</p>
      </div>
    </section>
  </main>

  <footer>
    <div class="muted">Demo backend: <span id="backend-url">https://air-datway-7-wrxp.onrender.com</span></div>
  </footer>

<script>
/* --------------------------
   CONFIG: Backend base URL
   -------------------------- */
const API = "https://air-datway-7-wrxp.onrender.com"; // <-- already set for you

/* Simple SPA nav */
const links = document.querySelectorAll('.navlink');
function show(view){
  document.querySelectorAll('.view').forEach(s=> s.style.display='none');
  document.getElementById(view).style.display='block';
  links.forEach(a=> a.classList.toggle('active', a.dataset.view===view));
}
links.forEach(a=> a.addEventListener('click', e=>{
  e.preventDefault();
  const v = a.dataset.view;
  show(v);
}));

/* initial view */
show('home');

/* Backend health check */
async function checkHealth(){
  try{
    const r = await fetch(API + '/health', {cache:'no-store'});
    if(!r.ok) throw new Error('down');
    const j = await r.json();
    document.getElementById('backend-status').textContent = 'OK — ' + (j.env || 'unknown');
  }catch(e){
    document.getElementById('backend-status').textContent = 'Not reachable';
  }
}
checkHealth();

/* Track action */
document.getElementById('trackBtn').addEventListener('click', async ()=>{
  const t = document.getElementById('trackInput').value.trim();
  const out = document.getElementById('trackResult');
  out.innerHTML = '<p class="muted">Loading...</p>';
  if(!t){ out.innerHTML = '<p class="muted">Enter a tracking number</p>'; return; }
  try{
    const r = await fetch(API + '/api/track/' + encodeURIComponent(t));
    const j = await r.json();
    if(!r.ok){ out.innerHTML = '<pre>'+JSON.stringify(j,null,2)+'</pre>'; return; }
    renderOrder(j, out);
  }catch(e){
    out.innerHTML = '<p class="muted">Error contacting backend</p>';
  }
});

/* Create order action */
document.getElementById('createBtn').addEventListener('click', async ()=>{
  const from = document.getElementById('fromCity').value.trim() || 'Unknown';
  const to = document.getElementById('toCity').value.trim() || 'Unknown';
  const weight = Number(document.getElementById('weight').value) || 0;
  const price = Number(document.getElementById('price').value) || 0;
  const customerName = document.getElementById('customerName').value.trim() || 'Guest';
  const out = document.getElementById('createResult');
  document.getElementById('createMsg').textContent = 'Creating…';
  try{
    const r = await fetch(API + '/api/orders', {
      method:'POST',
      headers:{'Content-Type':'application/json'},
      body: JSON.stringify({from:{city:from}, to:{city:to}, weightKg: weight, priceNaira: price, customerName })
    });
    const j = await r.json();
    if(!r.ok){ document.getElementById('createMsg').textContent = 'Error'; out.innerHTML = '<pre>'+JSON.stringify(j,null,2)+'</pre>'; return; }
    document.getElementById('createMsg').textContent = 'Created — copy tracking:';
    out.innerHTML = '<pre>'+JSON.stringify(j,null,2)+'</pre>';
    // populate track input for convenience
    document.getElementById('trackInput').value = j.trackingNumber || '';
  }catch(e){
    document.getElementById('createMsg').textContent = 'Error';
    out.innerHTML = '<p class="muted">Could not contact backend.</p>';
  }
});

/* render order details */
function renderOrder(o, container){
  let html = `<div class="card">
    <p><strong>Tracking:</strong> ${o.trackingNumber}</p>
    <p><strong>Customer:</strong> ${o.customerName}</p>
    <p><strong>From:</strong> ${o.from?.city || '-' } &nbsp; <strong>To:</strong> ${o.to?.city || '-'}</p>
    <p><strong>Weight:</strong> ${o.weightKg} kg &nbsp; <strong>Price:</strong> ₦${o.priceNaira}</p>
    <p><strong>Status:</strong> ${o.status}</p>
    <h4>Events</h4>
  </div>`;
  // events
  if(Array.isArray(o.events) && o.events.length){
    html += '<div class="card events">';
    o.events.forEach(ev=>{
      html += `<div class="event"><div><strong>${ev.status}</strong></div>
               <div class="small">${ev.location || ''} — ${new Date(ev.timestamp).toLocaleString()}</div>
               <div class="muted">${ev.note || ''}</div></div>`;
    });
    html += '</div>';
  } else {
    html += '<div class="muted card">No events available</div>';
  }
  if(container) container.innerHTML = html; else document.getElementById('trackResult').innerHTML = html;
}

/* set initial nav active */
document.querySelector('.navlink[data-view="home"]').classList.add('active');

</script>
</body>
</html>
